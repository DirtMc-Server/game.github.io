<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Space Survival</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
html,body {
    margin:0;
    padding:0;
    overflow:hidden;
    background:black;
    font-family:Arial, sans-serif;
    color:white;
}

canvas {
    position:absolute;
    top:0;
    left:0;
}

#topBar {
    position:absolute;
    top:0;
    width:100%;
    text-align:center;
    background:rgba(0,0,0,0.6);
    padding:8px;
    font-size:18px;
    z-index:10;
}

#bottomHUD {
    position:absolute;
    bottom:0;
    width:100%;
    background:rgba(0,0,0,0.7);
    display:flex;
    justify-content:space-around;
    padding:10px;
    font-size:14px;
    z-index:10;
}

#upgradeMenu {
    position:absolute;
    inset:0;
    background:rgba(0,0,0,0.95);
    display:none;
    z-index:20;
}

#upgradeTitle {
    text-align:center;
    font-size:24px;
    margin:10px;
}

#treeContainer {
    width:2000px;
    height:2000px;
    position:absolute;
    background:radial-gradient(#111,#000);
    cursor:grab;
}

.upgrade {
    position:absolute;
    width:140px;
    height:60px;
    background:linear-gradient(135deg,#333,#111);
    border:2px solid #555;
    border-radius:10px;
    text-align:center;
    padding:5px;
    font-size:12px;
}

.upgrade.locked {
    opacity:0.3;
}

.upgrade.unlocked {
    border-color:#0f0;
}

#continueBtn {
    position:absolute;
    top:10px;
    right:10px;
    padding:10px 15px;
    background:#0a0;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
#continueBtn:hover { background:#0c0; }

#modeSelect {
    position:absolute;
    inset:0;
    background:black;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    z-index:30;
}

#modeSelect button {
    margin:10px;
    padding:15px 30px;
    font-size:20px;
}

#joystick {
    position:absolute;
    bottom:120px;
    left:50%;
    transform:translateX(-50%);
    width:150px;
    height:150px;
    border-radius:50%;
    background:rgba(255,255,255,0.05);
    border:2px solid #555;
    display:none;
}

#stick {
    position:absolute;
    width:60px;
    height:60px;
    border-radius:50%;
    background:#888;
    left:45px;
    top:45px;
}
</style>
</head>

<body>

<div id="modeSelect">
    <h1>Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù„Ø¹Ø¨</h1>
    <button onclick="setMode('pc')">PC</button>
    <button onclick="setMode('mobile')">Ø¬ÙˆØ§Ù„</button>
</div>

<div id="topBar">ğŸš€ Space Survival</div>

<div id="bottomHUD">
    <div>â¤ï¸ Ø§Ù„Ø¯Ù…: <span id="hp">20</span></div>
    <div>ğŸ’° Ø§Ù„ÙÙ„ÙˆØ³: <span id="money">0</span></div>
    <div>ğŸš€ Ø§Ù„ØµÙˆØ§Ø±ÙŠØ®: <span id="dmg">3</span></div>
</div>

<button id="continueBtn" onclick="toggleUpgrades()">ğŸŒ³ Ø§Ù„ØªØ·ÙˆÙŠØ±Ø§Øª</button>

<div id="upgradeMenu">
    <div id="upgradeTitle">Ø´Ø¬Ø±Ø© Ø§Ù„ØªØ·ÙˆÙŠØ±Ø§Øª</div>
    <div id="treeContainer"></div>
</div>

<div id="joystick">
    <div id="stick"></div>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

let mode = null;
function setMode(m){
    mode = m;
    document.getElementById("modeSelect").style.display="none";
    if(m==="mobile") joystick.style.display="block";
}

let player = {
    x: canvas.width/2,
    y: canvas.height/2,
    hp:20,
    speed:3,
    dmg:3
};

let money = 0;
let rocks = [];
let missiles = [];
let lastShot = 0;

function spawnRock(){
    let size = Math.random()*30+20;
    rocks.push({
        x:Math.random()*canvas.width,
        y:-size,
        r:size,
        hp:10+size/5,
        dmg:2,
        speed:1+Math.random()
    });
}
setInterval(spawnRock,1000);

function shoot(){
    let target = rocks[0];
    if(!target) return;
    missiles.push({
        x:player.x,
        y:player.y,
        tx:target.x,
        ty:target.y
    });
}

function update(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Ø®Ù„ÙÙŠØ© Ù†Ø¬ÙˆÙ…
    ctx.fillStyle="black";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // Ø­Ø±ÙƒØ© PC
    if(mode==="pc"){
        canvas.onmousemove = e=>{
            player.x += (e.clientX-player.x)*0.05;
            player.y += (e.clientY-player.y)*0.05;
        }
    }

    // Ø±Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨
    ctx.fillStyle="cyan";
    ctx.beginPath();
    ctx.arc(player.x,player.y,15,0,Math.PI*2);
    ctx.fill();

    // ØµÙˆØ§Ø±ÙŠØ®
    if(Date.now()-lastShot>2000){
        shoot();
        lastShot=Date.now();
    }

    missiles.forEach(m=>{
        m.x+=(m.tx-m.x)*0.1;
        m.y+=(m.ty-m.y)*0.1;
        ctx.fillStyle="orange";
        ctx.fillRect(m.x-3,m.y-3,6,6);
    });

    // ØµØ®ÙˆØ±
    rocks.forEach((r,i)=>{
        r.y+=r.speed;
        if(r.y>canvas.height+r.r){
            r.y=-r.r;
            r.x=Math.random()*canvas.width;
        }
        ctx.fillStyle="#666";
        ctx.beginPath();
        ctx.arc(r.x,r.y,r.r,0,Math.PI*2);
        ctx.fill();

        // ØªØµØ§Ø¯Ù…
        let dx=player.x-r.x;
        let dy=player.y-r.y;
        if(Math.hypot(dx,dy)<r.r+15){
            player.hp-=r.dmg;
        }

        missiles.forEach((m,mi)=>{
            if(Math.hypot(m.x-r.x,m.y-r.y)<r.r){
                r.hp-=player.dmg;
                missiles.splice(mi,1);
                if(r.hp<=0){
                    money+=Math.floor(r.r);
                    rocks.splice(i,1);
                }
            }
        });
    });

    document.getElementById("hp").textContent=player.hp;
    document.getElementById("money").textContent=money;
    document.getElementById("dmg").textContent=player.dmg;

    requestAnimationFrame(update);
}
update();

// Ø´Ø¬Ø±Ø© ØªØ·ÙˆÙŠØ±Ø§Øª
const tree=document.getElementById("treeContainer");
let upgrades=[];
function addUpgrade(x,y,text,cost,apply){
    let d=document.createElement("div");
    d.className="upgrade locked";
    d.style.left=x+"px";
    d.style.top=y+"px";
    d.innerHTML=text+"<br>ğŸ’°"+cost;
    d.onclick=()=>{
        if(money>=cost){
            money-=cost;
            d.classList.remove("locked");
            d.classList.add("unlocked");
            apply();
        }
    };
    tree.appendChild(d);
}
addUpgrade(900,200,"Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¶Ø±Ø±",50,()=>player.dmg+=1);
addUpgrade(700,400,"Ø³Ø±Ø¹Ø© ØµÙˆØ§Ø±ÙŠØ®",80,()=>{});
addUpgrade(1100,400,"Ø¯Ù… Ø¥Ø¶Ø§ÙÙŠ",100,()=>player.hp+=10);

function toggleUpgrades(){
    let u=document.getElementById("upgradeMenu");
    u.style.display = u.style.display==="block"?"none":"block";
}
</script>

</body>
</html>
